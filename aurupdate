#!/bin/bash

# Function used to check if there are updates for a given package.
# Receives a target repository and checks if it is up to date.
# Stores the targets in their respective arrays.
#__________________________________________________________#
update() {                                                 # the shell inside of a shell
	target=$1					   # may have changed it's directory,
	msg=$(cd $target; git pull)			   # but the current shell didn't, so
                                                           # there's no need to cd back to anywhere now.
                                                           #
                                                           #
                                                           #
	if [ "$msg" == "Already up to date." ]		   #
	then						   #
		echo -e "${orange}$dir:${NC} $msg"         # uses color defined below
	else						   #
		echo $target > $HOME/.outdated		   #
	fi						   #
}                                                          #
#__________________________________________________________#


#______________________________#
#                              #
#   1. Preparing...            #
#______________________________#
                               #
orange='\033[0;33m'            # colors to be used.
NC='\033[0m'                   #
                               #
current=$(pwd)                 # way back.
                               #
outdated=$HOME/.outdated       #
mkfifo $outdated               # where we'll keep track of outdated packages.
#______________________________#


#______________________________#
#		               #
#   2. Running Things          #
#______________________________#
                               #
cd $HOME/AUR/                  # let's roll
		               #
		               #
for dir in $(ls); do           #
	update $dir &	       # checks for updates concurrently
done		               #
		               #
wait	                       # waits for all of the proccess to be completed
#______________________________# before going on

#______________________________#
#		               #
#  3. Updating packages        #
#______________________________#
if [ -s "$outdated" ]          #
then                           #
	while IFS= read -r dir #
	do                     #
		cd "$dir"      #
		echo $dir      #
		cd ..          #
	done < "$outdated"     #
fi                             #
#______________________________#


#____________#
             #
rm $outdated # removes the fifo file
cd $current  # go back
#____________#




















